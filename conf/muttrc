set mbox_type=Maildir
set folder = "$MAILDIR"
set header_cache=~/.cache/mutt
set record="$MAILDIR/sent"
set record=""

set signature="~/.signature"
set sig_dashes=no
set sig_on_top=no

mailboxes `echo ~/.mail/*/INBOX`

set reverse_name
set use_from=yes
set envelope_from=yes

#set autoedit=yes
set fast_reply=yes
set include=yes

auto_view text/html
alternative_order text/enriched text/plain text/html text

bind pager <up> previous-line
bind pager <down> next-line

set strict_threads="yes"
set sort=threads
set sort_browser=date
set sort_aux=reverse-last-date-received

# unset collapse_unread
set uncollapse_jump
bind index - collapse-thread
bind index _ collapse-all
folder-hook . "exec collapse-all"
#set tmpdir="$HOME/tmp"
set tmpdir="~/.tmp"

set text_flowed=yes

set timeout=10

set confirmappend = no

macro index a "<limit>all\n" "show all messages (undo limit)"


# Mu search
macro index l "<shell-escape>clear; read -p 'query: ' x; mu find  --format=links --linksdir=~/.mu/results --clearlinks \$x<enter><change-folder-readonly>~/.mu/results\n" "display mu-find results"

set query_command = "build contact search-email %s"

bind editor <Tab> complete-query
bind editor ^T    complete

bind index gg       first-entry
bind index G        last-entry

bind index,pager r        group-reply
bind index,pager R        group-reply
bind index,pager \cr        reply
bind index <tab>    sync-mailbox
bind index <space>  collapse-thread

bind pager k  previous-line
bind pager j  next-line
bind pager gg top
bind pager G  bottom
bind index,pager \cu half-up
bind index,pager \cd half-down

bind index,pager d delete-thread
bind index,pager D delete-message
bind index,pager u undelete-thread
bind index,pager U undelete-message


# View attachments properly.
bind attach <return> view-mailcap

macro index,pager A "<pipe-message>cat | awk '{ if (NF < 1) b=1; if (b) print; }' >> ~/documents/"
macro index,pager S "Ascratch.md<enter>d"

#macro pager \Cu "|urlview<enter>" "call urlview to open links"
macro index,pager U "<pipe-message> build system find-url<Enter>" "call urlscan to extract URLs out of a message"
macro attach,compose U "<pipe-entry> build system find-url<Enter>" "call urlscan to extract URLs out of a message"

#
#
# PGP
#
#




# the following two can have --encrypt-to 0x* to encrypt for self
set pgp_encrypt_only_command="pgpewrap gpg --batch --quiet --no-verbose --output - --encrypt --textmode --armor --always-trust  -- -r %r -- %f"
set pgp_encrypt_sign_command="pgpewrap gpg --passphrase-fd 0 --batch --quiet --no-verbose --textmode --output - --encrypt --sign %?a?-u %a? --armor --always-trust  -- -r %r -- %f"

set pgp_decode_command="gpg %?p?--passphrase-fd 0? --no-verbose --batch --output - %f"
set pgp_verify_command="gpg --no-verbose --batch --output - --verify %s %f"
set pgp_decrypt_command="gpg --passphrase-fd 0 --no-verbose --batch --output - %f"
set pgp_sign_command="gpg --no-verbose --batch --output - --passphrase-fd 0 --armor --detach-sign --textmode %?a?-u %a? %f"
set pgp_clearsign_command="gpg --no-verbose --batch --output - --passphrase-fd 0 --armor --textmode --clearsign %?a?-u %a? %f"
set pgp_import_command="gpg --no-verbose --import -v %f"
set pgp_export_command="gpg --no-verbose --export --armor %r"
set pgp_verify_key_command="gpg --no-verbose --batch --fingerprint --check-sigs %r"
set pgp_list_pubring_command="gpg --no-verbose --batch --with-colons --list-keys %r" 
set pgp_list_secring_command="gpg --no-verbose --batch --with-colons --list-secret-keys %r" 
set pgp_autosign=no
set pgp_replyencrypt=yes
set pgp_timeout=1800
set pgp_good_sign="^gpg: Good signature from"



#
#
#
# Style
#
# forked from https://github.com/altercation/mutt-colors-solarized
#



set status_format       = " %f %m%?n? [+%n]?%?d? [-%d]?%?t? [*%t]? %?p?[ %p ] draft? %>  %P   "
set mark_old=no

# vim: filetype=muttrc


# basic colors
color normal        brightyellow    default
color error         red             default
color tilde         black           default
color message       cyan            default
color markers       red             white
color attachment    white           default
color search        brightmagenta   default
color status        brightyellow    black
color indicator     brightblack     yellow
color tree          yellow          default # arrow in threads

# basic monocolor screen
mono  bold          bold
mono  underline     underline
mono  indicator     reverse
mono  error         bold

# index

color index         white           default         "~R"                        # read messages
color index         green           default         "~U"                        # unread messages
color index         brightyellow    default         "~P~U"                      # messages from me
color index         black           white           "~F"                        # flagged
color index         black           red             "~D"                        # deleted messages
color index         green           default         "~v~(~N)"                   # collapsed thread with some unread
color index         green           default         "~v~(~O)"                   # collapsed thread with some unread
color index         red             default         "~v~(~D)"                   # collapsed thread with some deleted

# message headers

#color header        brightgreen     default         "^"
color hdrdefault    brightgreen     default
color header        brightyellow    default         "^(From)"
color header        blue            default         "^(Subject)"

# body

color quoted        blue            default
color quoted1       cyan            default
color quoted2       yellow          default
color quoted3       red             default
color quoted4       brightred       default

color signature     brightgreen     default
color bold          black           default
color underline     black           default
color normal        default         default
color body          cyan            default         "(changed)"
color body          yellow          default         "(^| )(_.*_)( |$)"
color body          yellow          default         "(^| )(\\*.*\\*)( |$)"
color body          yellow          default         "(^| )(\\*\\*.*\\*\\*)( |$)"
mono  body          bold                            "(^| )(\\*\\*.*\\*\\*)( |$)"
color body          yellow          default         "(^(=*)$)"
color body          brightyellow    default         "(^(-*|_*)$)"
color body          brightyellow    default         "(^([A-Z][a-z]* [A-Z][a-z]*)$)"

## pgp

color body          red             default         "(BAD signature)"
color body          red             default         "(Verification failure)"
color body          cyan            default         "(Good signature)"
color body          brightblack     default         "^gpg: Good signature .*"
color body          brightyellow    default         "^gpg: "
color body          brightyellow    red             "^gpg: BAD signature from.*"
mono  body          bold                            "^gpg: Good signature"
mono  body          bold                            "^gpg: BAD signature from.*"

# url/email
color body          blue            default         "([a-z][a-z0-9+-]*://(((([a-z0-9_.!~*'();:&=+$,-]|%[0-9a-f][0-9a-f])*@)?((([a-z0-9]([a-z0-9-]*[a-z0-9])?)\\.)*([a-z]([a-z0-9-]*[a-z0-9])?)\\.?|[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+)(:[0-9]+)?)|([a-z0-9_.!~*'()$,;:@&=+-]|%[0-9a-f][0-9a-f])+)(/([a-z0-9_.!~*'():@&=+$,-]|%[0-9a-f][0-9a-f])*(;([a-z0-9_.!~*'():@&=+$,-]|%[0-9a-f][0-9a-f])*)*(/([a-z0-9_.!~*'():@&=+$,-]|%[0-9a-f][0-9a-f])*(;([a-z0-9_.!~*'():@&=+$,-]|%[0-9a-f][0-9a-f])*)*)*)?(\\?([a-z0-9_.!~*'();/?:@&=+$,-]|%[0-9a-f][0-9a-f])*)?(#([a-z0-9_.!~*'();/?:@&=+$,-]|%[0-9a-f][0-9a-f])*)?|(www|ftp)\\.(([a-z0-9]([a-z0-9-]*[a-z0-9])?)\\.)*([a-z]([a-z0-9-]*[a-z0-9])?)\\.?(:[0-9]+)?(/([-a-z0-9_.!~*'():@&=+$,]|%[0-9a-f][0-9a-f])*(;([-a-z0-9_.!~*'():@&=+$,]|%[0-9a-f][0-9a-f])*)*(/([-a-z0-9_.!~*'():@&=+$,]|%[0-9a-f][0-9a-f])*(;([-a-z0-9_.!~*'():@&=+$,]|%[0-9a-f][0-9a-f])*)*)*)?(\\?([-a-z0-9_.!~*'();/?:@&=+$,]|%[0-9a-f][0-9a-f])*)?(#([-a-z0-9_.!~*'();/?:@&=+$,]|%[0-9a-f][0-9a-f])*)?)[^].,:;!)? \t\r\n<>\"]"
color body          blue            default "((@(([0-9a-z-]+\\.)*[0-9a-z-]+\\.?|#[0-9]+|\\[[0-9]?[0-9]?[0-9]\\.[0-9]?[0-9]?[0-9]\\.[0-9]?[0-9]?[0-9]\\.[0-9]?[0-9]?[0-9]\\]),)*@(([0-9a-z-]+\\.)*[0-9a-z-]+\\.?|#[0-9]+|\\[[0-9]?[0-9]?[0-9]\\.[0-9]?[0-9]?[0-9]\\.[0-9]?[0-9]?[0-9]\\.[0-9]?[0-9]?[0-9]\\]):)?[0-9a-z_.+%$-]+@(([0-9a-z-]+\\.)*[0-9a-z-]+\\.?|#[0-9]+|\\[[0-2]?[0-9]?[0-9]\\.[0-2]?[0-9]?[0-9]\\.[0-2]?[0-9]?[0-9]\\.[0-2]?[0-9]?[0-9]\\])"


source " cat $ACCOUNTS/account.*.mutt 2>/dev/null|"
source " cat $LOCALDOT/conf/*.mutt 2>/dev/null|"
